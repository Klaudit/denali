<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <base href="/">

    <title> Actions  </title>

    <link href='//fonts.googleapis.com/css?family=Inconsolata|Bitter:400,700|Open+Sans:300,400,400italic,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-dropdown/2.0.3/jquery.dropdown.min.css" />
  </head>
  <body>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/vendor/jquery-2.2.2.min.js"><\/script>')</script>
    <nav class="navbar">
  <div class='container'>
    <a href='.' class='navbar-brand'>
      <img class='logo-light' src='images/logo.svg' alt='Denali'>
      <span class='project-name'>Denali</span>
    </a>

    <div class="navbar-nav">
      
      <a class='nav-link' href='v0.0.11/guides/overview/quickstart'>Quickstart</a>
      <a class='nav-link' href='v0.0.11/guides/overview/introduction'>Guides</a>
      <a class='nav-link' href='v0.0.11/api/modules/denali'>API</a>
      <a class='nav-link' href='https://github.com/denali-js/denali' target='_blank'>Github</a>
      <a class='nav-link' href='https://github.com/denali-js/denali/issues' target='_blank'>Issues</a>
    </div>
  </div>
</nav>

<div class='container'>
  <div class="row">
    <div class='guides-nav col-md-3'>
      <div class='nav-section'>
  <div class='nav-header'>Version</div>
  <div class='versions-menu-toggle' data-jq-dropdown='#versions-menu'>
    v0.0.11 
    <img class='versions-menu-caret' src='/images/caret.svg'>
  </div>
</div>

      
        <div class="nav-section">
          
            <div class='nav-header'>Overview</div>
          
          
            <a href='v0.0.11/guides/overview/introduction' class='nav-link'>Introduction</a>
          
            <a href='v0.0.11/guides/overview/quickstart' class='nav-link'>Quickstart</a>
          
            <a href='v0.0.11/guides/overview/app-structure' class='nav-link'>App Structure</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>Application</div>
          
          
            <a href='v0.0.11/guides/application/routing' class='nav-link'>Routing</a>
          
            <a href='v0.0.11/guides/application/actions' class='nav-link'>Actions</a>
          
            <a href='v0.0.11/guides/application/services' class='nav-link'>Services</a>
          
            <a href='v0.0.11/guides/application/errors' class='nav-link'>Errors</a>
          
            <a href='v0.0.11/guides/application/mailers' class='nav-link'>Mailers</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>Data</div>
          
          
            <a href='v0.0.11/guides/data/models' class='nav-link'>Models</a>
          
            <a href='v0.0.11/guides/data/serializers' class='nav-link'>Serializers</a>
          
            <a href='v0.0.11/guides/data/orm-adapters' class='nav-link'>ORM Adapters</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>Testing</div>
          
          
            <a href='v0.0.11/guides/testing/integration' class='nav-link'>Integration</a>
          
            <a href='v0.0.11/guides/testing/unit' class='nav-link'>Unit Testing</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>Configuration</div>
          
          
            <a href='v0.0.11/guides/configuration/environment' class='nav-link'>Environment</a>
          
            <a href='v0.0.11/guides/configuration/middleware' class='nav-link'>Middleware</a>
          
            <a href='v0.0.11/guides/configuration/initializers' class='nav-link'>Initializers</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>Utilities</div>
          
          
            <a href='v0.0.11/guides/utilities/mixins' class='nav-link'>Mixins</a>
          
            <a href='v0.0.11/guides/utilities/addons' class='nav-link'>Addons</a>
          
            <a href='v0.0.11/guides/utilities/instrumentation' class='nav-link'>Instrumentation</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>CLI</div>
          
          
            <a href='v0.0.11/guides/cli/generate' class='nav-link'>denali generate</a>
          
            <a href='v0.0.11/guides/cli/serve' class='nav-link'>denali serve</a>
          
            <a href='v0.0.11/guides/cli/test' class='nav-link'>denali test</a>
          
            <a href='v0.0.11/guides/cli/build' class='nav-link'>denali build</a>
          
            <a href='v0.0.11/guides/cli/addon' class='nav-link'>denali addon</a>
          
            <a href='v0.0.11/guides/cli/console' class='nav-link'>denali console</a>
          
        </div>
      
    </div>

    <div class='col-md-9 guides-body copy'>
      <a class="improve-btn" target="_blank" href="https://github.com/denali-js/denali/edit/master/guides/application/actions.md">Improve this page</a>
      <h1 id="actions">Actions</h1>
<p>Actions form the core of interacting with a Denali application. They are the
controller layer in the MVC architecture, taking in incoming requests,
performing business logic, and handing off to the renderer to send the
response.</p>
<p>When a request comes in, Denali&#39;s <a href="latest/guides/application/routing">Router</a> will map the method
and URL to a particular Action. It will invoke the <code>respond()</code> method on that
class, which should return either:</p>
<ol>
<li>a <code>Response</code> instance,</li>
<li>a Model instance or array of Model instances, or</li>
<li>a Promise which resolves with (1) or (2)</li>
</ol>
<h3 id="example-action">Example Action</h3>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> <span class="hljs-type">ApplicationAction</span> from './application';

export <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShowUser</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ApplicationAction</span> </span>{

  respond() {
    <span class="hljs-comment">// ...</span>
  }
}
</code></pre>
<h3 id="actions-as-controllers">Actions as controllers</h3>
<p>Actions are probably a bit different than most controllers you might be used to.
Rather than a single controller class that handles multiple different HTTP
endpoints, Actions represent just one endpoint (HTTP method + URL).</p>
<p>This might seem like overkill at first, but it enables powerful declarative
abstractions now that there is a 1:1 relationship between a class and
endpoint.</p>
<h2 id="responding">Responding</h2>
<p>The purpose of your Action is to respond to an incoming HTTP request. You do
this by defining a <code>respond()</code> method, and the return value (or resolved return
value) is used to render the response.</p>
<p>Your <code>respond()</code> method will be given a single argument: <code>params</code>. This is an
object that contains the combined data from the incoming request URL params (i.e.
<code>posts/:id</code>), query params (<code>posts?filter=foobar</code>), request body, and any
parameters specified when defining the route.</p>
<p>Because the <code>params</code> argument is the combined result of all these sources, it is
possible for naming collisions to occur (although in reality it&#39;s relatively
rare). In those cases, you can always access the raw sources via <code>this.request</code>
in your responder method (i.e. <code>this.request.query</code> holds the parsed query
params).</p>
<h2 id="content-negotiation">Content negotiation</h2>
<p>Denali&#39;s Actions support content negotiation out of the box. If the incoming
request includes an Accept header with a mime-type other than <code>*/*</code>, it will
attempt to find the responder that best matches that type.</p>
<p>Responders are methods on your Action whose name starts with <code>respond</code>. So, for
example, to respond to an HTML request (<code>Accept: text/html</code>), define a
<code>respondToHtml()</code> method on your Action. It will be invoked, instead of
<code>respond()</code>.</p>
<p>If there is no matching responder for the requested mime type, Denali will fall
back to the generic <code>respond()</code> method.</p>
<h2 id="filters">Filters</h2>
<p>Actions also support the concept of before and after filters. These are methods
that run before or after your responder method. Before filters also have the
ability to render a response and abort the rest of the action handling (i.e.
skip subsequent before filters and the responder).</p>
<p>To add a filter, simply add the method name to the <code>before</code> or <code>after</code> array on
your Action:</p>
<pre><code class="lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreatePurchase</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Action</span> </span>{

  static before = [ <span class="hljs-symbol">'authenticateUse</span>r', <span class="hljs-symbol">'confirmBalanc</span>e' ];
  static after = [ <span class="hljs-symbol">'trackPurchas</span>e' ];

  authenticateUser() {
    <span class="hljs-comment">// makes sure the user is logged in</span>
  }

  confirmBalance() {
    <span class="hljs-comment">// make sure the user has money to make the purchase</span>
  }

  trackPurchase() {
    <span class="hljs-comment">// log the purchase in an analytics tool, but don't hold up rendering the</span>
    <span class="hljs-comment">// response for it</span>
  }

}
</code></pre>
<p>Filters are inherited. Want to authenticate all requests against your API? Just
add an authentication before filter to your ApplicationAction, and it will run
on all requests:</p>
<pre><code class="lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationAction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Action</span> </span>{

  static before = [ <span class="hljs-symbol">'authenticat</span>e' ];

  authenticate() {
    <span class="hljs-comment">// This allows individual actions to "opt-out" of authentication by setting</span>
    <span class="hljs-comment">// `protected = false;`</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-keyword">protected</span> !== <span class="hljs-literal">false</span>) {
      <span class="hljs-comment">// authenticate the user</span>
    }
  }

}
</code></pre>
<p>Filters behave much like responders: they receive the params argument, and if
they return any value other than null (or a Promise that resolves to a value
other than null), Denali will halt the request processing and attempt to render
that value as the response.</p>
<blockquote>
<p><strong>Note:</strong> this means that you should take extra care with the return values of
your filter methods. Accidentally returning a value will cause the request
processing to halt prematurely, and Denali will attempt to render that value!</p>
</blockquote>

    </div>
  </div>
</div>

<footer class="footer">
  <div class='container'>
    Made with <img src='images/fox-and-beard.svg' class='fox-and-beard'> at
    <a href='http://foxandbeard.co' target='_blank'>Fox and Beard</a>
  </div>
</footer>

  <div id='versions-menu' class='versions-menu jq-dropdown jq-dropdown-tip'>
    <ul class='jq-dropdown-menu'>
      
        <li>
          
            <a href='/v0.0.16/guides/application/actions'>v0.0.16 </a>
          
        </li>
      
        <li>
          
            <a href='/v0.0.15/guides/application/actions'>v0.0.15 </a>
          
        </li>
      
        <li>
          
            <a href='/v0.0.14/guides/application/actions'>v0.0.14 </a>
          
        </li>
      
        <li>
          
            <a href='/v0.0.13/guides/application/actions'>v0.0.13 (canary)</a>
          
        </li>
      
        <li>
          
            <a href='/v0.0.12/guides/application/actions'>v0.0.12 </a>
          
        </li>
      
        <li>
          
            <a class='active'>v0.0.11 </a>
          
        </li>
      
        <li>
          
            <a href='/v0.0.10/guides/application/actions'>v0.0.10 </a>
          
        </li>
      
        <li>
          
            <a href='/v0.0.9/guides/application/actions'>v0.0.9 </a>
          
        </li>
      
        <li>
          
            <a href='/v0.0.8/guides/application/actions'>v0.0.8 </a>
          
        </li>
      
        <li>
          
            <a href='/v0.0.7/guides/application/actions'>v0.0.7 </a>
          
        </li>
      
        <li>
          
            <a href='/master/guides/application/actions'>master </a>
          
        </li>
      
    </ul>
  </div>
  <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery-dropdown/2.0.3/jquery.dropdown.min.js'></script>



    <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
     ga('create', 'UA-85043775-1', 'auto');
     ga('send', 'pageview');
    </script>
  </body>
</html>
