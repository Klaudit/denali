<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <base href="/denali/">

  <title>Actions</title>
  <meta name="description" content="">

  <link href='//fonts.googleapis.com/css?family=Inconsolata|Bitter:400,700|Open+Sans:300,400,400italic,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="css/main.css">
  <link rel="canonical" href="https://davewasmer.github.com/denali/guides/actions/">
</head>

  <body>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/vendor/jquery-2.2.2.min.js"><\/script>')</script>
    <nav class="navbar">
  <div class='container'>
    <a href='.' class='navbar-brand'>
      <img class='logo-light' src='images/logo.svg' alt='Denali'>
      <span class='project-name'>Denali</span>
    </a>

    <div class="navbar-nav">
      <a class='nav-link' href='latest/guides/quickstart'>Quickstart</a>
      <a class='nav-link' href='latest/guides/introduction'>Guides</a>
      <a class='nav-link' href='latest/api'>API</a>
      <a class='nav-link' href='https://github.com/davewasmer/denali' target='_blank'>Github</a>
      <a class='nav-link' href='https://github.com/davewasmer/denali/issues' target='_blank'>Issues</a>
    </div>
  </div>
</nav>

<div class='container'>
  <div class="row">
    <div class='guides-nav col-md-3'>

  <div class='nav-section'>
  <div class='nav-header'>Version</div>
  <select class='versions-select' id='versions'>
    
      <option value='canary' >canary</option>
    
      <option value='latest' selected='selected'>latest</option>
    
  </select>
</div>


  
    <div class="nav-section">
      
      
        <a href='canary/guides/introduction/' class='nav-link'>Introduction</a>
      
        <a href='canary/guides/quickstart/' class='nav-link'>Quickstart</a>
      
        <a href='canary/guides/app-structure/' class='nav-link'>App Structure</a>
      
    </div>
  
    <div class="nav-section">
      
        <div class='nav-header'>Application</div>
      
      
        <a href='canary/guides/routing/' class='nav-link'>Routing</a>
      
        <a href='canary/guides/actions/' class='nav-link'>Actions</a>
      
        <a href='canary/guides/services/' class='nav-link'>Services</a>
      
        <a href='canary/guides/errors/' class='nav-link'>Errors</a>
      
        <a href='canary/guides/mailers/' class='nav-link'>Mailers</a>
      
    </div>
  
    <div class="nav-section">
      
        <div class='nav-header'>Data</div>
      
      
        <a href='canary/guides/models/' class='nav-link'>Models</a>
      
        <a href='canary/guides/serializers/' class='nav-link'>Serializers</a>
      
        <a href='canary/guides/orm-adapters/' class='nav-link'>ORM Adapters</a>
      
    </div>
  
    <div class="nav-section">
      
        <div class='nav-header'>Testing</div>
      
      
        <a href='canary/guides/integration/' class='nav-link'>Integration</a>
      
        <a href='canary/guides/unit/' class='nav-link'>Unit Testing</a>
      
    </div>
  
    <div class="nav-section">
      
        <div class='nav-header'>Configuration</div>
      
      
        <a href='canary/guides/environment/' class='nav-link'>Environment</a>
      
        <a href='canary/guides/middleware/' class='nav-link'>Middleware</a>
      
        <a href='canary/guides/initializers/' class='nav-link'>Initializers</a>
      
    </div>
  
    <div class="nav-section">
      
        <div class='nav-header'>Utilities</div>
      
      
        <a href='canary/guides/mixins.js' class='nav-link'>Mixins</a>
      
        <a href='canary/guides/addons/' class='nav-link'>Addons</a>
      
        <a href='canary/guides/instrumentation/' class='nav-link'>Instrumentation</a>
      
    </div>
  
    <div class="nav-section">
      
        <div class='nav-header'>CLI</div>
      
      
        <a href='canary/guides/generate/' class='nav-link'>denali generate</a>
      
        <a href='canary/guides/serve/' class='nav-link'>denali serve</a>
      
        <a href='canary/guides/test/' class='nav-link'>denali test</a>
      
        <a href='canary/guides/build/' class='nav-link'>denali build</a>
      
        <a href='canary/guides/addon/' class='nav-link'>denali addon</a>
      
        <a href='canary/guides/console/' class='nav-link'>denali console</a>
      
    </div>
  

</div>

    <div class='col-md-9 guides-body copy'>
      <a class="improve-btn" target="_blank" href="https://github.com/davewasmer/denali/edit/master/guides/actions.md">Improve this page</a>
      <h1 id="actions">Actions</h1>

<p>Actions form the core of interacting with a Denali application. They are the
controller layer in the MVC architecture, taking in incoming requests,
performing business logic, and handing off to the renderer to send the
response.</p>

<p>When a request comes in, Denali’s <a href="guides/routing">Router</a> will map the method
and URL to a particular Action. It will invoke the <code class="highlighter-rouge">respond()</code> method on that
class, which should return either:</p>

<ol>
  <li>a <code class="highlighter-rouge">Response</code> instance,</li>
  <li>a Model instance or array of Model instances, or</li>
  <li>a Promise which resolves with (1) or (2)</li>
</ol>

<h3 id="example-action">Example Action</h3>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kr">import</span> <span class="nx">ApplicationAction</span> <span class="nx">from</span> <span class="s1">'./application'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">ShowUser</span> <span class="kr">extends</span> <span class="nx">ApplicationAction</span> <span class="p">{</span>

  <span class="nx">respond</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="actions-as-controllers">Actions as controllers</h3>

<p>Actions are probably a bit different than most controllers you might be used to.
Rather than a single controller class that handles multiple different HTTP
endpoints, Actions represent just one endpoint (HTTP method + URL).</p>

<p>This might seem like overkill at first, but it enables powerful declarative
abstractions now that there is a 1:1 relationship between a class and
endpoint.</p>

<h2 id="responding">Responding</h2>

<p>The purpose of your Action is to respond to an incoming HTTP request. You do
this by defining a <code class="highlighter-rouge">respond()</code> method, and the return value (or resolved return
value) is used to render the response.</p>

<p>Your <code class="highlighter-rouge">respond()</code> method will be given a single argument: <code class="highlighter-rouge">params</code>. This is an
object that contains the combined data from the incoming request URL params (i.e.
<code class="highlighter-rouge">posts/:id</code>), query params (<code class="highlighter-rouge">posts?filter=foobar</code>), request body, and any
parameters specified when defining the route.</p>

<p>Because the <code class="highlighter-rouge">params</code> argument is the combined result of all these sources, it is
possible for naming collisions to occur (although in reality it’s relatively
rare). In those cases, you can always access the raw sources via <code class="highlighter-rouge">this.request</code>
in your responder method (i.e. <code class="highlighter-rouge">this.request.query</code> holds the parsed query
params).</p>

<h2 id="content-negotiation">Content negotiation</h2>

<p>Denali’s Actions support content negotiation out of the box. If the incoming
request includes an Accept header with a mime-type other than <code class="highlighter-rouge">*/*</code>, it will
attempt to find the responder that best matches that type.</p>

<p>Responders are methods on your Action whose name starts with <code class="highlighter-rouge">respond</code>. So, for
example, to respond to an HTML request (<code class="highlighter-rouge">Accept: text/html</code>), define a
<code class="highlighter-rouge">respondToHtml()</code> method on your Action. It will be invoked, instead of
<code class="highlighter-rouge">respond()</code>.</p>

<p>If there is no matching responder for the requested mime type, Denali will fall
back to the generic <code class="highlighter-rouge">respond()</code> method.</p>

<h2 id="filters">Filters</h2>

<p>Actions also support the concept of before and after filters. These are methods
that run before or after your responder method. Before filters also have the
ability to render a response and abort the rest of the action handling (i.e.
skip subsequent before filters and the responder).</p>

<p>To add a filter, simply add the method name to the <code class="highlighter-rouge">before</code> or <code class="highlighter-rouge">after</code> array on
your Action:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kr">class</span> <span class="nx">CreatePurchase</span> <span class="kr">extends</span> <span class="nx">Action</span> <span class="p">{</span>

  <span class="kr">static</span> <span class="nx">before</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">'authenticateUser'</span><span class="p">,</span> <span class="s1">'confirmBalance'</span> <span class="p">];</span>
  <span class="kr">static</span> <span class="nx">after</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">'trackPurchase'</span> <span class="p">];</span>

  <span class="nx">authenticateUser</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// makes sure the user is logged in</span>
  <span class="p">}</span>

  <span class="nx">confirmBalance</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// make sure the user has money to make the purchase</span>
  <span class="p">}</span>

  <span class="nx">trackPurchase</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// log the purchase in an analytics tool, but don't hold up rendering the</span>
    <span class="c1">// response for it</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre>
</div>

<p>Filters are inherited. Want to authenticate all requests against your API? Just
add an authentication before filter to your ApplicationAction, and it will run
on all requests:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kr">class</span> <span class="nx">ApplicationAction</span> <span class="kr">extends</span> <span class="nx">Action</span> <span class="p">{</span>

  <span class="kr">static</span> <span class="nx">before</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">'authenticate'</span> <span class="p">];</span>

  <span class="nx">authenticate</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// This allows individual actions to "opt-out" of authentication by setting</span>
    <span class="c1">// `protected = false;`</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">protected</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// authenticate the user</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre>
</div>

<p>Filters behave much like responders: they receive the params argument, and if
they return any value other than null (or a Promise that resolves to a value
other than null), Denali will halt the request processing and attempt to render
that value as the response.</p>

<blockquote>
  <p><strong>Note:</strong> this means that you should take extra care with the return values of
your filter methods. Accidentally returning a value will cause the request
processing to halt prematurely, and Denali will attempt to render that value!</p>
</blockquote>


    </div>
  </div>
</div>

<footer class="footer">
  <div class='container'>
    Made with <img src='images/fox-and-beard.svg' class='fox-and-beard'> at
    <a href='http://foxandbeard.co' target='_blank'>Fox and Beard</a>
  </div>
</footer>

<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
    (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
    function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
    e=o.createElement(i);r=o.getElementsByTagName(i)[0];
    e.src='//www.google-analytics.com/analytics.js';
    r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
    ga('create','UA-XXXXX-X','auto');ga('send','pageview');
</script>


  </body>
</html>
