<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <base href="denali/">

    <title></title>
    <!-- <meta name="description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ description }}{% endif %}"> -->

    <link href='//fonts.googleapis.com/css?family=Inconsolata|Bitter:400,700|Open+Sans:300,400,400italic,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="styles.css">
    <!-- <link rel="canonical" href="{% page.url | replace:'index.html','' | prepend: baseurl | prepend: url }}"> -->
  </head>
  <body>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/vendor/jquery-2.2.2.min.js"><\/script>')</script>
    <nav class="navbar">
  <div class='container'>
    <a href='.' class='navbar-brand'>
      <img class='logo-light' src='images/logo.svg' alt='Denali'>
      <span class='project-name'>Denali</span>
    </a>

    <div class="navbar-nav">
      
      <a class='nav-link' href='canary/guides/overview/quickstart'>Quickstart</a>
      <a class='nav-link' href='canary/guides/overview/introduction'>Guides</a>
      <a class='nav-link' href='canary/api/modules/denali'>API</a>
      <a class='nav-link' href='https://github.com/davewasmer/denali' target='_blank'>Github</a>
      <a class='nav-link' href='https://github.com/davewasmer/denali/issues' target='_blank'>Issues</a>
    </div>
  </div>
</nav>


<div class='container'>
  <div class="row">
    <div class='guides-nav col-md-3'>
      <div class='nav-section'>
  <div class='nav-header'>Version</div>
  <select class='versions-select' id='versions'>
    
      <option value='canary' selected='selected'>canary</option>
    
  </select>
</div>

      
        <div class="nav-section">
          
            <div class='nav-header'>Overview</div>
          
          
            <a href='canary/guides/overview/introduction' class='nav-link'>Introduction</a>
          
            <a href='canary/guides/overview/quickstart' class='nav-link'>Quickstart</a>
          
            <a href='canary/guides/overview/app-structure' class='nav-link'>App Structure</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>Application</div>
          
          
            <a href='canary/guides/application/routing' class='nav-link'>Routing</a>
          
            <a href='canary/guides/application/actions' class='nav-link'>Actions</a>
          
            <a href='canary/guides/application/services' class='nav-link'>Services</a>
          
            <a href='canary/guides/application/errors' class='nav-link'>Errors</a>
          
            <a href='canary/guides/application/mailers' class='nav-link'>Mailers</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>Data</div>
          
          
            <a href='canary/guides/data/models' class='nav-link'>Models</a>
          
            <a href='canary/guides/data/serializers' class='nav-link'>Serializers</a>
          
            <a href='canary/guides/data/orm-adapters' class='nav-link'>ORM Adapters</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>Testing</div>
          
          
            <a href='canary/guides/testing/integration' class='nav-link'>Integration</a>
          
            <a href='canary/guides/testing/unit' class='nav-link'>Unit Testing</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>Configuration</div>
          
          
            <a href='canary/guides/configuration/environment' class='nav-link'>Environment</a>
          
            <a href='canary/guides/configuration/middleware' class='nav-link'>Middleware</a>
          
            <a href='canary/guides/configuration/initializers' class='nav-link'>Initializers</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>Utilities</div>
          
          
            <a href='canary/guides/utilities/mixins' class='nav-link'>Mixins</a>
          
            <a href='canary/guides/utilities/addons' class='nav-link'>Addons</a>
          
            <a href='canary/guides/utilities/instrumentation' class='nav-link'>Instrumentation</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>CLI</div>
          
          
            <a href='canary/guides/cli/generate' class='nav-link'>denali generate</a>
          
            <a href='canary/guides/cli/serve' class='nav-link'>denali serve</a>
          
            <a href='canary/guides/cli/test' class='nav-link'>denali test</a>
          
            <a href='canary/guides/cli/build' class='nav-link'>denali build</a>
          
            <a href='canary/guides/cli/addon' class='nav-link'>denali addon</a>
          
            <a href='canary/guides/cli/console' class='nav-link'>denali console</a>
          
        </div>
      
    </div>
    <div class='col-md-9 guides-body copy'>
      <a class="improve-btn" target="_blank" href="https://github.com/davewasmer/denali/edit/master/guides/mailers">Improve this page</a>
      <h1 id="mailers">Mailers</h1>
<p>Most web applications of non-trivial size will need to send emails to users.
Denali&#39;s Mailers provide a convention-based, out of the box solution that scales
from simple transactional emails all the way up to complex digests, all while
abstracting the emails from the method of sending (i.e. SES, Mandrill, Sendgrid,
etc).</p>
<h2 id="concepts">Concepts</h2>
<p>Denali exposes a <code>Mailer</code> class, which represents an email that is sent. It
captures all the associated logic of that email - if it needs to lookup data
from a database, that happens in the Mailer class. Mailers are defined in
<code>app/mailers/</code>.</p>
<p>Each Mailer class is paired with template files to define the body of the email.
By convention, the template files are stored right next to mailer files, and use
the same name (but different extensions - one for the HTML version of the email,
and one for the plain text version):</p>
<pre><code>app/
  mailers/
    welcome.js   &lt;- The mailer class
    welcome.html &lt;- The HTML version of the email body
    welcome.txt  &lt;- The plain text version of the email body
</code></pre><p>It&#39;s not required to have both a plain text and HTML version of an email -
either one is fine alone.</p>
<h2 id="creating-a-mailer">Creating a Mailer</h2>
<p>To get started sending emails, let&#39;s create a mailer. You can use the <code>generate</code>
command in the Denali CLI to scaffold out a new mailer for you:</p>
<pre><code>$ denali generate mailer welcome
</code></pre><p>This will create a blank mailer for us. In this case, we&#39;re building a welcome
email to send after a user signs up. Now lets update the scaffolded templates
with our welcome message:</p>
<pre><code>// app/mailers/welcome.html
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta content=&#39;text/html; charset=UTF-8&#39; http-equiv=&#39;Content-Type&#39; /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Welcome to example.com, &lt;%= user.name %&gt;!&lt;/h1&gt;
    &lt;p&gt;Thanks for joining and have a great day!&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>And our plain text version (it&#39;s usually a good idea to have both, since some
email clients prefer plain text to HTML):</p>
<pre><code>// app/mailers/welcome.txt
Welcome to example.com, &lt;%= user.name %&gt;!
Thanks for joining and have a great day!
</code></pre><p>Notice our template tags in both templates, where we dynamically insert the
user&#39;s name into the template.</p>
<p>Now, if we wanted to pull in additional data, we could override the <code>welcome.js</code>
mailer&#39;s <code>send()</code> method, like this:</p>
<pre><code>// app/mailers/welcome.js
import { Mailer } from &#39;denali&#39;;

export default class WelcomeMailer extends Mailer {
  send(user) {
    let Topic = this.modelFor(&#39;topic&#39;);
    return Topic.findInteresting().then((interestingTopics) =&gt; {
      return this.mail({
        to: user.email,
        from: &#39;notifications@example.com&#39;,
        subject: &#39;Welcome!&#39;,
        html: this.template(&#39;html&#39;, { user, interestingTopics }),
        text: this.template(&#39;text&#39;, { user, interestingTopics })
      });
  }
}
</code></pre><p>Notice that we use <code>this.mail({ to, from, subject, html, text })</code> to actually
send the email once we&#39;ve gathered all the relevant data.</p>
<h2 id="sending-the-email">Sending the email</h2>
<p>Now that we have a mailer ready to go, let&#39;s wire it up to a <code>users/sign-up</code>
action so that new users will be sent a welcome email:</p>
<p>   // app/actions/users/sign-up.js
   respond(params) {
     let User = this.modelFor(&#39;user&#39;);
     return User.create(params).then((newUser) =&gt; {
       this.mail(&#39;welcome&#39;, newUser);
       return newUser;
     });
   }</p>
<p>As we can see, actions come with a <code>this.mail</code> method which invoke the named
mailer with the data supplied (in this case, our new user record).</p>
<p>Notice also that, despite <code>this.mail()</code> returning a Promise, we don&#39;t wait for
it to finish the action. This let&#39;s us leverage Node&#39;s asynchronous behavior to
finish the request as soon as possible rather than waiting for the email to
finish before responding to the incoming request.</p>

    </div>
  </div>
</div>

<footer class="footer">
  <div class='container'>
    Made with <img src='images/fox-and-beard.svg' class='fox-and-beard'> at
    <a href='http://foxandbeard.co' target='_blank'>Fox and Beard</a>
  </div>
</footer>

<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
    (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
    function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
    e=o.createElement(i);r=o.getElementsByTagName(i)[0];
    e.src='//www.google-analytics.com/analytics.js';
    r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
    ga('create','UA-XXXXX-X','auto');ga('send','pageview');
</script>



  </body>
</html>
