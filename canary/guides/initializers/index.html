<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Initializers</title>
  <meta name="description" content="">

  <link href='https://fonts.googleapis.com/css?family=Inconsolata|Lato:400,700|Open+Sans:400,400italic,700|Montserrat+Alternates:700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="denali/css/main.css">
  <link rel="canonical" href="http://denali.github.com/denalidenali/guides/initializers/">
</head>

  <body>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/vendor/jquery-2.2.2.min.js"><\/script>')</script>
    <nav class="navbar navbar-full navbar-dark">
  <div class='container'>
    <a href='/' class='navbar-brand'>
      <img class='logo-light' src='/images/logo.png' alt='Denali'>
      <span class='project-name'>denali</span>
    </a>

    <div class='nav navbar-nav pull-xs-right'>
      <li class='nav-item'>
        <a class='nav-link' href='/canary/guides/quickstart'>Quickstart</a>
      </li>
      <li class='nav-item'>
        <a class='nav-link' href='/canary/guides/introduction'>Guides</a>
      </li>
      <li class='nav-item'>
        <a class='nav-link' href='/canary/api'>API</a>
      </li>
      <li class='nav-item'>
        <a class='nav-link' href='https://github.com/davewasmer/denali' target='_blank'>Github</a>
      </li>
      <li class='nav-item'>
        <a class='nav-link' href='https://github.com/davewasmer/denali/issues' target='_blank'>Issues</a>
      </li>
    </div>
  </div>
</nav>

<div class='container'>
  <div class="row">
    <div class='guides-nav col-md-3'>

  <div class='nav-section'>
  <div class='nav-header'>Version</div>
  <select id='versions'>
    
      <option value='canary' selected='selected'>canary</option>
    
  </select>
</div>


  
    <div class='nav-section'>
      
      
        <a href='/canary/guides/introduction/' class='nav-link'>Introduction</a>
      
        <a href='/canary/guides/quickstart/' class='nav-link'>Quickstart</a>
      
        <a href='/canary/guides/app-structure/' class='nav-link'>App Structure</a>
      
    </div>
  
    <div class='nav-section'>
      
        <div class='nav-header'>Application</div>
      
      
        <a href='/canary/guides/routing/' class='nav-link'>Routing</a>
      
        <a href='/canary/guides/actions/' class='nav-link'>Actions</a>
      
        <a href='/canary/guides/services/' class='nav-link'>Services</a>
      
        <a href='/canary/guides/errors/' class='nav-link'>Errors</a>
      
        <a href='/canary/guides/mailers/' class='nav-link'>Mailers</a>
      
    </div>
  
    <div class='nav-section'>
      
        <div class='nav-header'>Data</div>
      
      
        <a href='/canary/guides/models/' class='nav-link'>Models</a>
      
        <a href='/canary/guides/serializers/' class='nav-link'>Serializers</a>
      
        <a href='/canary/guides/orm-adapters/' class='nav-link'>ORM Adapters</a>
      
    </div>
  
    <div class='nav-section'>
      
        <div class='nav-header'>Testing</div>
      
      
        <a href='/canary/guides/integration/' class='nav-link'>Integration</a>
      
        <a href='/canary/guides/unit/' class='nav-link'>Unit Testing</a>
      
    </div>
  
    <div class='nav-section'>
      
        <div class='nav-header'>Configuration</div>
      
      
        <a href='/canary/guides/environment/' class='nav-link'>Environment</a>
      
        <a href='/canary/guides/middleware/' class='nav-link'>Middleware</a>
      
        <a href='/canary/guides/initializers/' class='nav-link'>Initializers</a>
      
    </div>
  
    <div class='nav-section'>
      
        <div class='nav-header'>Utilities</div>
      
      
        <a href='/canary/guides/mixins.js' class='nav-link'>Mixins</a>
      
        <a href='/canary/guides/addons/' class='nav-link'>Addons</a>
      
        <a href='/canary/guides/instrumentation/' class='nav-link'>Instrumentation</a>
      
    </div>
  
    <div class='nav-section'>
      
        <div class='nav-header'>CLI</div>
      
      
        <a href='/canary/guides/generate/' class='nav-link'>denali generate</a>
      
        <a href='/canary/guides/serve/' class='nav-link'>denali serve</a>
      
        <a href='/canary/guides/test/' class='nav-link'>denali test</a>
      
        <a href='/canary/guides/build/' class='nav-link'>denali build</a>
      
        <a href='/canary/guides/addon/' class='nav-link'>denali addon</a>
      
        <a href='/canary/guides/console/' class='nav-link'>denali console</a>
      
    </div>
  
</div>

    <div class='col-md-9 guides-body'>
      <a class="btn btn-info pull-xs-right" target="_blank" href="https://github.com/davewasmer/denali/edit/master/guides/initializers.md">Improve this page</a>
      <h1 id="initializers">Initializers</h1>

<p>Initializers a functions that run after your application is loaded into memory,
but before it binds to a port to start accepting connections. It’s the ideal
spot to do any kind of bootstrapping or setup to get your app ready to start
serving connections.</p>

<p>Initializers can return a Promise, and the application will wait for it to
resolve before proceeding to the next initializer (or starting the app if that
was the last one).</p>

<p>For example, here’s an initializer that sets up a connection to a hypothetical
database, and pauses the application startup until the connection is
established:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kr">import</span> <span class="nx">MyDbManager</span> <span class="nx">from</span> <span class="s1">'db-manager'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Promise</span> <span class="nx">from</span> <span class="s1">'bluebird'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'db-connect'</span><span class="p">,</span>
  <span class="nx">initialize</span><span class="p">(</span><span class="nx">application</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">dbConfig</span> <span class="o">=</span> <span class="nx">application</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="s1">'config:environment'</span><span class="p">).</span><span class="nx">db</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyDbManager</span><span class="p">(</span><span class="nx">dbConfig</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">db</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'connect'</span><span class="p">,</span> <span class="nx">resolve</span><span class="p">);</span>
      <span class="nx">db</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="nx">reject</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="initializer-order">Initializer order</h2>

<p>Sometimes you may way an initializer to run before or after another. To let
Denali know what the order should be, just add a <code class="highlighter-rouge">before</code> and/or <code class="highlighter-rouge">after</code> array
to your initializer object which contains the names of the initializers that
should run before or after:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'sync-schema'</span><span class="p">,</span>
  <span class="na">after</span><span class="p">:</span> <span class="p">[</span> <span class="s1">'db-connect'</span> <span class="p">],</span>
  <span class="nx">initialize</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// the 'db-connect' initializer has completed by this point</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

    </div>
  </div>
</div>

<footer class="footer">

</footer>

<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
    (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
    function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
    e=o.createElement(i);r=o.getElementsByTagName(i)[0];
    e.src='//www.google-analytics.com/analytics.js';
    r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
    ga('create','UA-XXXXX-X','auto');ga('send','pageview');
</script>


  </body>
</html>
