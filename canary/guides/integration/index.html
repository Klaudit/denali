<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Integration</title>
  <meta name="description" content="">

  <link href='https://fonts.googleapis.com/css?family=Inconsolata|Lato:400,700|Open+Sans:400,400italic,700|Montserrat+Alternates:700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://denali.github.com/denali/guides/integration/">
</head>

  <body>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/vendor/jquery-2.2.2.min.js"><\/script>')</script>
    <nav class="navbar navbar-full navbar-dark">
  <div class='container'>
    <a href='/' class='navbar-brand'>
      <img class='logo-light' src='/images/logo.png' alt='Denali'>
      <span class='project-name'>denali</span>
    </a>

    <div class='nav navbar-nav pull-xs-right'>
      <li class='nav-item'>
        <a class='nav-link' href='/canary/guides/quickstart'>Quickstart</a>
      </li>
      <li class='nav-item'>
        <a class='nav-link' href='/canary/guides/introduction'>Guides</a>
      </li>
      <li class='nav-item'>
        <a class='nav-link' href='/canary/api'>API</a>
      </li>
      <li class='nav-item'>
        <a class='nav-link' href='https://github.com/davewasmer/denali' target='_blank'>Github</a>
      </li>
      <li class='nav-item'>
        <a class='nav-link' href='https://github.com/davewasmer/denali/issues' target='_blank'>Issues</a>
      </li>
    </div>
  </div>
</nav>

<div class='container'>
  <div class="row">
    <div class='guides-nav col-md-3'>

  <div class='nav-section'>
  <div class='nav-header'>Version</div>
  <select id='versions'>
    
      <option value='canary' selected='selected'>canary</option>
    
  </select>
</div>


  
    <div class='nav-section'>
      
      
        <a href='/canary/guides/introduction/' class='nav-link'>Introduction</a>
      
        <a href='/canary/guides/quickstart/' class='nav-link'>Quickstart</a>
      
        <a href='/canary/guides/app-structure/' class='nav-link'>App Structure</a>
      
    </div>
  
    <div class='nav-section'>
      
        <div class='nav-header'>Application</div>
      
      
        <a href='/canary/guides/routing/' class='nav-link'>Routing</a>
      
        <a href='/canary/guides/actions/' class='nav-link'>Actions</a>
      
        <a href='/canary/guides/services/' class='nav-link'>Services</a>
      
        <a href='/canary/guides/errors/' class='nav-link'>Errors</a>
      
    </div>
  
    <div class='nav-section'>
      
        <div class='nav-header'>Data</div>
      
      
        <a href='/canary/guides/models/' class='nav-link'>Models</a>
      
        <a href='/canary/guides/serializers/' class='nav-link'>Serializers</a>
      
        <a href='/canary/guides/orm-adapters/' class='nav-link'>ORM Adapters</a>
      
    </div>
  
    <div class='nav-section'>
      
        <div class='nav-header'>Testing</div>
      
      
        <a href='/canary/guides/integration/' class='nav-link'>Integration</a>
      
        <a href='/canary/guides/unit/' class='nav-link'>Unit Testing</a>
      
    </div>
  
    <div class='nav-section'>
      
        <div class='nav-header'>Configuration</div>
      
      
        <a href='/canary/guides/environment/' class='nav-link'>Environment</a>
      
        <a href='/canary/guides/middleware/' class='nav-link'>Middleware</a>
      
        <a href='/canary/guides/initializers/' class='nav-link'>Initializers</a>
      
    </div>
  
    <div class='nav-section'>
      
        <div class='nav-header'>Utilities</div>
      
      
        <a href='/canary/guides/mixins.js' class='nav-link'>Mixins</a>
      
        <a href='/canary/guides/instrumentation.js' class='nav-link'>Instrumentation</a>
      
    </div>
  
    <div class='nav-section'>
      
        <div class='nav-header'>CLI</div>
      
      
        <a href='/canary/guides/generate/' class='nav-link'>denali generate</a>
      
        <a href='/canary/guides/serve/' class='nav-link'>denali serve</a>
      
        <a href='/canary/guides/test/' class='nav-link'>denali test</a>
      
        <a href='/canary/guides/build/' class='nav-link'>denali build</a>
      
        <a href='/canary/guides/addon/' class='nav-link'>denali addon</a>
      
        <a href='/canary/guides/console/' class='nav-link'>denali console</a>
      
    </div>
  
</div>

    <div class='col-md-9 guides-body'>
      <a class="btn btn-info pull-xs-right" target="_blank" href="https://github.com/davewasmer/denali/edit/master/guides/integration.md">Improve this page</a>
      <h1 id="integration-testing">Integration Testing</h1>

<p>Denali comes with some testing helpers out of the box to make integration
testing simpler. While most of the tooling is based on Denali’s testing
framework of choice, Mocha, the principles here should be applicable across
testing frameworks.</p>

<h2 id="setupapp"><code class="highlighter-rouge">setupApp()</code></h2>

<p>This is the starting point of the Denali test helpers. When defining an
integration test suite, just add <code class="highlighter-rouge">setupApp()</code> to the block:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="s1">'Creating a post'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

  <span class="nx">setupApp</span><span class="p">();</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">'should create something'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">});</span>

<span class="p">});</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">setupApp()</code> will automatically handle the setup, initialization, and teardown
of an instance of your Application. It also adds the <code class="highlighter-rouge">this.app</code> property to the
test suite.</p>

<h2 id="making-test-requests">Making test requests</h2>

<p>In your tests, <code class="highlighter-rouge">this.app</code> provides a simple API for interacting with your app in
the test environment. In particular, it exposes methods for each HTTP verb (i.e.
<code class="highlighter-rouge">this.app.get()</code>, <code class="highlighter-rouge">this.app.post()</code>, etc) which let you simulate a request to
your app.</p>

<p>To make a test request, it’s as simple as:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nx">it</span><span class="p">(</span><span class="s1">'should list posts'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/posts'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(({</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">body</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">status</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">body</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">an</span><span class="p">.</span><span class="nx">array</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre>
</div>

<p>There’s a few things to note here:</p>

<ul>
  <li>The request method (<code class="highlighter-rouge">this.app.get</code>) returns a Promise. Don’t forget to
  return that Promise when using Mocha to make sure it waits for your async
  activity to finish!</li>
  <li>The promise resolves to an object with a <code class="highlighter-rouge">status</code> and <code class="highlighter-rouge">body</code> property</li>
  <li>If the app responds with a status code &gt;= 500, the request method will
  reject the promise. If it’s &lt; 500, it resolves it. This means that error
  responses from your API like 401 Unauthorized will result in the test request
  promise being <em>resolved</em>.</li>
</ul>

<h3 id="headers">Headers</h3>

<p>Often when testing you’ll need to manipulate the headers sent with the requests.
This is frequently done to manage login / logout state (via the Authorization
header). The test app provides a way to do this via <code class="highlighter-rouge">this.app.setHeader(name,
value)</code>. Headers persist on the test app, so you can log in as your test user in
a <code class="highlighter-rouge">before()</code> block, and stay logged in for the whole thing.</p>

    </div>
  </div>
</div>

<footer class="footer">

</footer>

<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
    (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
    function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
    e=o.createElement(i);r=o.getElementsByTagName(i)[0];
    e.src='//www.google-analytics.com/analytics.js';
    r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
    ga('create','UA-XXXXX-X','auto');ga('send','pageview');
</script>


  </body>
</html>
