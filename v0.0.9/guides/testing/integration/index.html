<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <base href="/">

    <title></title>
    <!-- <meta name="description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ description }}{% endif %}"> -->

    <link href='//fonts.googleapis.com/css?family=Inconsolata|Bitter:400,700|Open+Sans:300,400,400italic,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="styles.css">
    <!-- <link rel="canonical" href="{% page.url | replace:'index.html','' | prepend: baseurl | prepend: url }}"> -->
  </head>
  <body>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/vendor/jquery-2.2.2.min.js"><\/script>')</script>
    <nav class="navbar">
  <div class='container'>
    <a href='.' class='navbar-brand'>
      <img class='logo-light' src='images/logo.svg' alt='Denali'>
      <span class='project-name'>Denali</span>
    </a>

    <div class="navbar-nav">
      
      <a class='nav-link' href='v0.0.9/guides/overview/quickstart'>Quickstart</a>
      <a class='nav-link' href='v0.0.9/guides/overview/introduction'>Guides</a>
      <a class='nav-link' href='v0.0.9/api/modules/denali'>API</a>
      <a class='nav-link' href='https://github.com/denali-js/denali' target='_blank'>Github</a>
      <a class='nav-link' href='https://github.com/denali-js/denali/issues' target='_blank'>Issues</a>
    </div>
  </div>
</nav>

<div class='container'>
  <div class="row">
    <div class='guides-nav col-md-3'>
      <div class='nav-section'>
  <div class='nav-header'>Version</div>
  <select class='versions-select' id='versions'>
    
      <option value='v0.0.10' >v0.0.10</option>
    
      <option value='v0.0.9' selected='selected'>v0.0.9</option>
    
      <option value='v0.0.8' >v0.0.8</option>
    
      <option value='v0.0.7' >v0.0.7</option>
    
      <option value='canary' >canary</option>
    
  </select>
</div>

      
        <div class="nav-section">
          
            <div class='nav-header'>Overview</div>
          
          
            <a href='v0.0.9/guides/overview/introduction' class='nav-link'>Introduction</a>
          
            <a href='v0.0.9/guides/overview/quickstart' class='nav-link'>Quickstart</a>
          
            <a href='v0.0.9/guides/overview/app-structure' class='nav-link'>App Structure</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>Application</div>
          
          
            <a href='v0.0.9/guides/application/routing' class='nav-link'>Routing</a>
          
            <a href='v0.0.9/guides/application/actions' class='nav-link'>Actions</a>
          
            <a href='v0.0.9/guides/application/services' class='nav-link'>Services</a>
          
            <a href='v0.0.9/guides/application/errors' class='nav-link'>Errors</a>
          
            <a href='v0.0.9/guides/application/mailers' class='nav-link'>Mailers</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>Data</div>
          
          
            <a href='v0.0.9/guides/data/models' class='nav-link'>Models</a>
          
            <a href='v0.0.9/guides/data/serializers' class='nav-link'>Serializers</a>
          
            <a href='v0.0.9/guides/data/orm-adapters' class='nav-link'>ORM Adapters</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>Testing</div>
          
          
            <a href='v0.0.9/guides/testing/integration' class='nav-link'>Integration</a>
          
            <a href='v0.0.9/guides/testing/unit' class='nav-link'>Unit Testing</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>Configuration</div>
          
          
            <a href='v0.0.9/guides/configuration/environment' class='nav-link'>Environment</a>
          
            <a href='v0.0.9/guides/configuration/middleware' class='nav-link'>Middleware</a>
          
            <a href='v0.0.9/guides/configuration/initializers' class='nav-link'>Initializers</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>Utilities</div>
          
          
            <a href='v0.0.9/guides/utilities/mixins' class='nav-link'>Mixins</a>
          
            <a href='v0.0.9/guides/utilities/addons' class='nav-link'>Addons</a>
          
            <a href='v0.0.9/guides/utilities/instrumentation' class='nav-link'>Instrumentation</a>
          
        </div>
      
        <div class="nav-section">
          
            <div class='nav-header'>CLI</div>
          
          
            <a href='v0.0.9/guides/cli/generate' class='nav-link'>denali generate</a>
          
            <a href='v0.0.9/guides/cli/serve' class='nav-link'>denali serve</a>
          
            <a href='v0.0.9/guides/cli/test' class='nav-link'>denali test</a>
          
            <a href='v0.0.9/guides/cli/build' class='nav-link'>denali build</a>
          
            <a href='v0.0.9/guides/cli/addon' class='nav-link'>denali addon</a>
          
            <a href='v0.0.9/guides/cli/console' class='nav-link'>denali console</a>
          
        </div>
      
    </div>

    <div class='col-md-9 guides-body copy'>
      <a class="improve-btn" target="_blank" href="https://github.com/denali-js/denali/edit/master/guides/testing/integration.md">Improve this page</a>
      <h1 id="integration-testing">Integration Testing</h1>
<p>Denali comes with some testing helpers out of the box to make integration
testing simpler. While most of the tooling is based on Denali&#39;s testing
framework of choice, Mocha, the principles here should be applicable across
testing frameworks.</p>
<h2 id="-setupapp-"><code>setupApp()</code></h2>
<p>This is the starting point of the Denali test helpers. When defining an
integration test suite, just add <code>setupApp()</code> to the block:</p>
<pre><code class="lang-js">describe(&#39;Creating a post&#39;, function() {

  setupApp();

  it(&#39;should create something&#39;, function() {
    // ...
  });

});
</code></pre>
<p><code>setupApp()</code> will automatically handle the setup, initialization, and teardown
of an instance of your Application. It also adds the <code>this.app</code> property to the
test suite.</p>
<h2 id="making-test-requests">Making test requests</h2>
<p>In your tests, <code>this.app</code> provides a simple API for interacting with your app in
the test environment. In particular, it exposes methods for each HTTP verb (i.e.
<code>this.app.get()</code>, <code>this.app.post()</code>, etc) which let you simulate a request to
your app.</p>
<p>To make a test request, it&#39;s as simple as:</p>
<pre><code class="lang-js">it(&#39;should list posts&#39;, function() {
  return this.app.get(&#39;/posts&#39;)
    .then(({ status, body }) =&gt; {
      expect(status).to.equal(200);
      expect(body).to.be.an.array();
    });
});
</code></pre>
<p>There&#39;s a few things to note here:</p>
<ul>
<li>The request method (<code>this.app.get</code>) returns a Promise. Don&#39;t forget to
return that Promise when using Mocha to make sure it waits for your async
activity to finish!</li>
<li>The promise resolves to an object with a <code>status</code> and <code>body</code> property</li>
<li>If the app responds with a status code &gt;= 500, the request method will
reject the promise. If it&#39;s &lt; 500, it resolves it. This means that error
responses from your API like 401 Unauthorized will result in the test request
promise being <em>resolved</em>.</li>
</ul>
<h3 id="headers">Headers</h3>
<p>Often when testing you&#39;ll need to manipulate the headers sent with the requests.
This is frequently done to manage login / logout state (via the Authorization
header). The test app provides a way to do this via <code>this.app.setHeader(name,
value)</code>. Headers persist on the test app, so you can log in as your test user in
a <code>before()</code> block, and stay logged in for the whole thing.</p>

    </div>
  </div>
</div>

<footer class="footer">
  <div class='container'>
    Made with <img src='images/fox-and-beard.svg' class='fox-and-beard'> at
    <a href='http://foxandbeard.co' target='_blank'>Fox and Beard</a>
  </div>
</footer>

<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
    (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
    function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
    e=o.createElement(i);r=o.getElementsByTagName(i)[0];
    e.src='//www.google-analytics.com/analytics.js';
    r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
    ga('create','UA-XXXXX-X','auto');ga('send','pageview');
</script>


  </body>
</html>
